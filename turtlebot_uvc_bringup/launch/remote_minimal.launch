<launch>
    <!-- Turtlebot -->
    <arg name="battery"           default="$(env TURTLEBOT_BATTERY)"      doc="kernel provided locatio for battery info, use /proc/acpi/battery/BAT0 in 2.6 or earlier kernels." />
    <arg name="simulation"        default="$(env TURTLEBOT_SIMULATION)"   doc="set flags to indicate this turtle is run in simulation mode."/>
    <arg name="serialport"        default="$(env TURTLEBOT_SERIAL_PORT)"  doc="used by create to configure the port it is connected on [/dev/ttyUSB0, /dev/ttyS0]"/>

    <param name="/use_sim_time" value="$(arg simulation)"/>


    <arg name="urdf_file" default="$(find xacro)/xacro '$(find turtlebot_description)/robots/kobuki_hexagons_astra.urdf.xacro'"/>
    <param name="robot_description" command="$(arg urdf_file)"/>


    <param name="robot/name" value="$(optenv ROBOT turtlebot)"/>
    <param name="robot/type" value="turtlebot"/>
            
    <node pkg="robot_state_publisher" type="robot_state_publisher" name="robot_state_publisher">
        <param name="publish_frequency" type="double" value="5.0" />
    </node>
    <node pkg="diagnostic_aggregator" type="aggregator_node" name="diagnostic_aggregator" >
        <rosparam command="load" file="$(find turtlebot_bringup)/param/kobuki/diagnostics.yaml" />
    </node>


    <node pkg="nodelet" type="nodelet" name="mobile_base_nodelet_manager" args="manager"/>
    
    
    <node pkg="nodelet" type="nodelet" name="mobile_base" args="load kobuki_node/KobukiNodelet mobile_base_nodelet_manager">
        <rosparam file="$(find kobuki_node)/param/base.yaml" command="load"/>
        <param name="device_port" value="$(arg serialport)" />

        <remap from="mobile_base/odom" to="odom"/>
        <remap from="mobile_base/enable" to="enable"/>
        <remap from="mobile_base/disable" to="disable"/>
        <remap from="mobile_base/joint_states" to="joint_states"/>
    </node>
  
  
    <node pkg="nodelet" type="nodelet" name="bumper2pointcloud" args="load kobuki_bumper2pc/Bumper2PcNodelet mobile_base_nodelet_manager">
        <param name="pointcloud_radius" value="0.24"/>
        <remap from="bumper2pointcloud/pointcloud"   to="mobile_base/sensors/bumper_pointcloud"/>
        <remap from="bumper2pointcloud/core_sensors" to="mobile_base/sensors/core"/>
    </node>


    <node pkg="nodelet" type="nodelet" name="cmd_vel_mux" args="load yocs_cmd_vel_mux/CmdVelMuxNodelet mobile_base_nodelet_manager">
        <param name="yaml_cfg_file" value="$(find turtlebot_bringup)/param/mux.yaml"/>
        <remap from="cmd_vel_mux/output" to="mobile_base/commands/velocity"/>
    </node>


    <node pkg="laptop_battery_monitor" type="laptop_battery.py" name="turtlebot_laptop_battery">
        <param name="acpi_path" type="string" value="$(arg battery)" />
    </node>

</launch>
